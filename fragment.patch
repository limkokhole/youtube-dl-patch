--- /home/xiaobai/Downloads/youtube-dl/latest_git/youtube-dl/build/lib/youtube_dl/downloader/fragment.py	2019-09-11 23:23:22.000000000 +0800
+++ /home/xiaobai/.virtualenvs/youtubedlbuild/lib/python3.6/site-packages/youtube_dl-2020.7.28-py3.6.egg/youtube_dl/downloader/fragment.py	2020-09-01 04:50:12.805865676 +0800
@@ -18,6 +18,11 @@
     def to_screen(self, *args, **kargs):
         pass
 
+# hole patch:
+from ..utils import get_fs_max, get_max_path
+from ..utils import sanitize_path # not mine sanitize_"patch"
+arg_cut = -1
+fs_f_max = get_fs_max()
 
 class FragmentFD(FileDownloader):
     """
@@ -96,7 +101,25 @@
         frag_index_stream.close()
 
     def _download_fragment(self, ctx, frag_url, info_dict, headers=None):
-        fragment_filename = '%s-Frag%d' % (ctx['tmpfilename'], ctx['fragment_index'])
+
+        # hole patch:
+        tp = os.path.split(ctx['tmpfilename'])[1]
+        if '-' in tp:
+            tp = tp.split('-')[0]
+        elif '.f' in tp: # last resort if no '-'(which shouldn't be if set '-' in format outside), possible confict if run multiple threads of youtube-dl
+            tp = tp.split('.f')[0]
+        elif '.' in tp:
+            tp = tp.split('.')[0]
+        tpd = os.path.split(ctx['tmpfilename'])[0]
+        t = '-Frag' + str(ctx['fragment_index'])
+        redundant_part = '.part.part' # sacrifice 10 bytes 
+        fpart = get_max_path(arg_cut, fs_f_max, tp, t + redundant_part, False) + t
+        #fragment_filename = '%s-Frag%d' % (tp, ctx['fragment_index'])
+        fragment_filename = os.path.abspath( os.path.join(tpd, '{}'.format( fpart )) )
+        print('frm pre: ' + repr(fragment_filename))
+        fragment_filename = sanitize_path(fragment_filename)
+        print('frm post: ' + repr(fragment_filename))
+
         success = ctx['dl'].download(fragment_filename, {
             'url': frag_url,
             'http_headers': headers or info_dict.get('http_headers'),
